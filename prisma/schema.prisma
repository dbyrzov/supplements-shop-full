generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

// ========================
// USERS
// ========================
model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  phone     String?
  orders    Order[]
  reviews   Review[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ========================
// CATEGORIES
// ========================
model Category {
  id            Int           @id @default(autoincrement())
  name          String        @unique
  slug          String        @unique
  description   String?
  imageUrl      String?
  products      Product[]
  subcategories Subcategory[]
}

// ========================
// SUBCATEGORIES
// ========================
model Subcategory {
  id         Int      @id @default(autoincrement())
  name       String
  slug       String   @unique
  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  products   Product[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([categoryId])
}

// ========================
// BRAND
// ========================
model Brand {
  id       Int       @id @default(autoincrement())
  name     String    @unique
  slug     String    @unique
  logo     String?
  products Product[]
}

// ========================
// PRODUCTS
// ========================
model Product {
  id          Int      @id @default(autoincrement())
  name        String
  slug        String   @unique
  description String?

  brandId     Int?
  brand       Brand?   @relation(fields: [brandId], references: [id], onDelete: SetNull)

  categoryId    Int
  category      Category    @relation(fields: [categoryId], references: [id], onDelete: Cascade)

  subcategoryId Int
  subcategory   Subcategory @relation(fields: [subcategoryId], references: [id], onDelete: Cascade)

  nutritionProfile NutritionProfile?
  ingredients       Ingredient[]
  tags              ProductTag[]
  variants          ProductVariant[]
  reviews           Review[]
  images            ProductImage[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([categoryId])
  @@index([subcategoryId])
  @@index([brandId])
}

// ========================
// PRODUCT IMAGES
// ========================
model ProductImage {
  id        Int     @id @default(autoincrement())
  productId Int
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  url       String
  isPrimary Boolean @default(false)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productId])
}

// ========================
// PRODUCT VARIANTS
// ========================
model ProductVariant {
  id        Int     @id @default(autoincrement())
  productId Int
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  flavorId  Int?
  flavor    Flavor? @relation(fields: [flavorId], references: [id], onDelete: SetNull)

  sku       String  @unique
  grams     Float
  price     Float
  stock     Int     @default(0)

  orderItems OrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([productId])
  @@index([flavorId])
}

// ========================
// FLAVORS
// ========================
model Flavor {
  id       Int             @id @default(autoincrement())
  name     String          @unique
  variants ProductVariant[]
}

// ========================
// NUTRITION PROFILE
// ========================
model NutritionProfile {
  id          Int     @id @default(autoincrement())
  productId   Int     @unique
  servingSize String
  calories    Int
  protein     Float
  carbs       Float
  fats        Float

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
}

// ========================
// INGREDIENTS
// ========================
model Ingredient {
  id        Int     @id @default(autoincrement())
  productId Int
  name      String
  amount    String?

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
}

// ========================
// TAGS
// ========================
model Tag {
  id       Int          @id @default(autoincrement())
  name     String       @unique
  products ProductTag[]
}

model ProductTag {
  productId Int
  tagId     Int

  product Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  tag     Tag     @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([productId, tagId])
}

// ========================
// GIFTS
// ========================
model Gift {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  description String?
  imageUrl    String?
  price       Float
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// ========================
// ORDERS
// ========================
model Order {
  id              Int      @id @default(autoincrement())
  userId          Int
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  items           OrderItem[]
  total           Float

  status          String   @default("PENDING")
  paymentMethod   String?

  shippingAddress String
  shippingCost    Float?
  trackingNumber  String?
  notes           String?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([userId])
  @@index([status])
}

// ========================
// ORDER ITEM
// ========================
model OrderItem {
  id               Int            @id @default(autoincrement())
  orderId          Int
  order            Order          @relation(fields: [orderId], references: [id], onDelete: Cascade)

  productVariantId Int
  variant          ProductVariant @relation(fields: [productVariantId], references: [id], onDelete: Cascade)

  quantity         Int
  priceAtPurchase  Float

  @@index([orderId])
  @@index([productVariantId])
}

// ========================
// REVIEWS
// ========================
model Review {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  productId Int
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  rating    Int
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([productId])
}

// ========================
// PROMO
// ========================
model PromoMessage {
  id        Int      @id @default(autoincrement())
  message   String
  isActive  Boolean  @default(true)
  order     Int      @default(0)
  createdAt DateTime @default(now())
}