generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ========================
// USERS
// ========================
model User {
  id        Int       @id @default(autoincrement())
  name      String
  email     String    @unique
  password  String
  phone     String?
  orders    Order[]
  reviews   Review[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

// ========================
// CATEGORIES
// ========================
model Category {
  id          Int       @id @default(autoincrement())
  name        String    @unique
  description String?
  imageUrl    String?
  products    Product[]
}

// ========================
// PRODUCTS
// ========================
model Product {
  id             Int        @id @default(autoincrement())
  name           String
  description    String?
  price          Float
  imageUrl       String?
  stock          Int        @default(0)
  sku            String?    @unique
  weight         Float?
  servingSize    String?
  ingredients    String?    // ще пазим JSON като текст
  nutritionInfo  String?    // ще пазим JSON като текст
  allergens      String?
  brand          String?
  tags           String?    // CSV string за филтри и етикети
  rating         Float?     @default(0)
  categoryId     Int
  category       Category   @relation(fields: [categoryId], references: [id])
  reviews        Review[]
  orderItems     OrderItem[]
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt
}

// ========================
// GIFTS
// ========================
model Gift {
  id          Int       @id @default(autoincrement())
  name        String @unique
  description String?
  imageUrl    String?
  price       Float
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// ========================
// ORDERS
// ========================
model Order {
  id              Int         @id @default(autoincrement())
  userId          Int
  user            User        @relation(fields: [userId], references: [id])
  items           OrderItem[]
  total           Float
  status          String      @default("PENDING")  // PENDING, PROCESSING, SHIPPED, DELIVERED, CANCELLED, REFUNDED
  paymentMethod   String?     // "card", "paypal", "cash"
  shippingAddress String
  shippingCost    Float?
  trackingNumber  String?
  notes           String?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
}

model OrderItem {
  id         Int      @id @default(autoincrement())
  orderId    Int
  order      Order    @relation(fields: [orderId], references: [id])
  productId  Int
  product    Product  @relation(fields: [productId], references: [id])
  quantity   Int      @default(1)
  price      Float    // цена на единица към момента на поръчката
}

// ========================
// REVIEWS
// ========================
model Review {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  productId Int
  product   Product  @relation(fields: [productId], references: [id])
  rating    Int      // 1-5
  comment   String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
